## 1. 서비스 개요 및 전략

* **서비스명**: 가설재/유로폼 특화 B2B 중개 플랫폼.
* **핵심 전략**:
  * 아날로그(전화)와 디지털(플랫폼) 주문의 완벽한 병행.
  * 연령층이 높은 사용자를 고려한 **'무옵션/단일주문'** 체계.
  * 운영자가 물류(배차/톤수)와 정산을 직접 중개하여 신뢰도 확보.

---

## 2. 사용자 유형 및 권한 관리

| 구분 | 역할 및 권한 상세 | 시스템 이용 범위 |
| --- | --- | --- |
| **수요업체(구매자)** | 상품 검색, 장바구니 담기, 플랫폼 주문, 입금 확인, 세금계산서 수령. | 로그인 가능 (사업자 승인 후 주문 권한 부여) |
| **공급업체(판매자)** | 상품 등록 및 재고 관리, 판매 중단, 정산 대금 수령. | 로그인 가능 (구매자에게 연락처 비노출) |
| **운영자(Admin)** | **전화 주문 대행**, 화물 톤수 계산, 배차 요청, 상차 사진 백업/전송, 정산 총괄, 상품 승인 및 수정. | 전체 시스템 마스터 권한 |
| **배송업체(차주)** | 운영자의 요청에 따른 상차 및 배송 수행. | **외부 협력자** (시스템 미접속, 유선 소통) |

---

## 3. 회원가입 및 인증 프로세스 (승인제)

### **가입 절차**
* **가입 로직**: ID/PWD 방식 (소셜 로그인 X). ID 중복 확인 + **대표 연락처 인증** 필수.
* **사업자등록번호**: 회원가입 시 필수 입력 항목.
* **서비스 권한**: 
  * 가입 즉시 로그인은 가능하나, **사업자등록증 업로드 및 운영자 승인** 전까지는 주문 등 거래 기능 이용 불가.
  * 비로그인 사용자도 **상품 목록 조회는 가능**.

### **사업자 관리**
* 한 계정으로 **여러 개의 사업자등록증** 등록 가능 (최소 1개 승인 시 서비스 활성화).
* 사업자 정보(주소 등) 변경 시 **운영자 승인**이 있어야 반영됨.
* 운영자가 문자로 받은 사업자등록증을 대신 등록해 줄 수 있는 대행 기능 포함.

### **동시 접속**
* 한 계정으로 여러 단말기에서 **동시 접속 허용**.

---

## 4. 상품 및 카테고리 체계 (실무 로직 반영)

### **분류 체계 (Depth 3)**
* **가설재**: 구분 > 품목 > 규격 (상태: 신재, 고재)
* **유로폼**: 구분(유로폼) > 품목(신재, 쇼트신재, 쇼트뒤집기, 고재) > 규격(1200, 900, 600 등)
* *유로폼은 일반 가설재보다 복잡한 '품목(쇼트/뒤집기 등)' 단계를 포함함.*

### **상품 등록 규칙**
* **필수 필드**: 
  * 상차지 주소 (지도 API를 통해 입력, 시/구 단위까지만 노출)
  * 판매 단위(참고용)
  * 수량(단위 무관 입력 가능)
  * 단가, 금액
  * 사진(최소 3장 이상)
* **등록 프로세스**: 
  * 판매자가 상품 등록 시 **운영자 승인** 필수.
  * 승인 전까지는 상품이 플랫폼에 노출되지 않음.
* **특이사항**: 
  * 상품은 옵션을 가지지 않음(1개 품목=1개 상품).
  * 상품 상세 페이지에서 **해당 판매자의 다른 판매 상품**도 함께 노출.

### **상품 수정 규칙**
* **판매자 권한**:
  * 판매 중인 상품의 **가격 수정 가능**.
  * 판매 중인 상품의 **재고는 수정 불가** (새 상품 등록 필요).
  * 판매 중인 상품의 **이미지 수정 불가**.
  * 판매 중단 설정 가능.
* **운영자 권한**:
  * 모든 상품 정보(가격, 재고, 이미지 등) **수정 가능**.

### **상품 노출 규칙**
* **주소 노출**: 상차지 주소를 시/구 단위까지만 표시 (예: 대전시 유성구).
* **상세주소**: 주문 확정 후 거래 당사자에게만 공개.

---

## 5. 장바구니 및 주문 시스템

### **장바구니 기능**
* 한 주문에 **여러 상품** 담기 가능.
* **제약사항**: 
  * 장바구니에는 **동일 판매자의 상품만** 담을 수 있음.
  * A 판매자 상품이 담긴 상태에서 B 판매자 상품 추가 시도 시:
    * 기존 장바구니 비우기 후 추가 가능 (배달의민족 방식).
    * 사용자에게 명확한 안내 메시지 제공.

### **주문 방식**
* **플랫폼 주문**: 구매자가 직접 장바구니에서 주문.
* **전화 주문**: 운영자가 관리자 페이지에서 주문 대행 등록.

---

## 6. 주소 및 배송지 관리

### **주소 체계**
* **지도 API 활용**: 모든 주소는 지도 API를 통해 입력하여 일관성 확보.
* **주소 구분**:
  * **사업자 주소**: 사업자등록증상의 주소.
  * **야적장 주소**: 실제 상/하차 장소 (사업자 주소와 동일할 수 있음).
  * **배송지**: Entity로 별도 관리 (사용자 편의를 위한 주소록 기능).

### **배송지 관리**
* 구매자는 자주 사용하는 **배송지를 등록/관리** 가능.
* 주문 시 등록된 배송지 중 선택하거나 새로 입력.
* 주문 완료 시 상/하차지는 **스냅샷으로 저장** (이후 주소 변경에 영향받지 않음).

---

## 7. 주문 및 물류 상세 플로우

```mermaid
sequenceDiagram
    participant B as 수요업체 (구매자)
    participant P as 플랫폼 (운영자)
    participant S as 공급업체 (판매자)
    participant D as 배송업체 (외부)

    Note over B, S: [인증] 사업자 등록 및 운영자 승인 완료 후 주문 가능
    
    alt 플랫폼 주문
        B->>B: 장바구니에 동일 판매자 상품 담기
        B->>P: 플랫폼 내 주문 요청
    else 전화 주문
        B->>P: 운영자에게 전화로 구매 요청
        P->>P: 운영자가 관리자 페이지에서 주문 대행 등록
    end

    Note over P: [물류] 운영자가 화물 톤수 계산 및 차량(카고/윙바디) 구분
    P->>D: 외부 배송업체 배차 요청 (전화/문자)
    D-->>P: 상차 완료 보고 및 상차 사진 전송
    
    P->>B: 배송 시작 문자 자동 발송
    P->>S: 배송 시작 문자 자동 발송
    
    Note over P: 운영자가 상차 사진 시스템 백업 및 구매자에게 전송
    P->>B: 상차 사진 전송
```

---

## 8. 정산 및 문서 발행 로직

* **정산 단계**: 구매자 입금(운영자 계좌) → 운영자가 판매자/배송업체에게 각각 정산.
* **세금계산서**: 운영자가 국세청을 통해 수동 발행.
* **거래명세서 자동화**:
  * 시스템에서 **거래명세서 양식**에 데이터를 채워 구매자에게 이메일 발송.
  * 발송 시 **운영자의 통장 사본**을 반드시 함께 첨부.

---

## 9. 주요 관리 및 마이페이지 기능

### **비밀번호 관리**
* **로그인 전**: 휴대폰 인증을 통한 비밀번호 초기화(임시 비밀번호 발송) 가능.
* **로그인 후**: 직접 비밀번호 재설정.

### **판매자 전용 기능**
* **판매 관리**: 자신이 올린 상품의 판매 진행 상황(주문/상차 등)을 확인할 수 있는 전용 화면 제공.
* **상품 관리**: 가격 수정, 판매 중단 설정.

### **구매자 전용 기능**
* **배송지 관리**: 자주 사용하는 배송지 등록/수정/삭제.
* **주문 내역**: 주문 상태별 조회 및 거래명세서 확인.

---

## 10. 주요 변경/추가 사항 요약

### **새로 추가된 기능**
1. **장바구니 시스템**: 동일 판매자 상품만 담기 제약 포함.
2. **배송지 Entity 관리**: 사용자 편의를 위한 주소록 기능.
3. **지도 API 통합**: 일관된 주소 입력 및 시/구 단위 노출.
4. **상품 상세 페이지**: 해당 판매자의 다른 상품 노출.
5. **상품 승인 프로세스**: 최초 등록 시 운영자 승인 필수.
6. **비로그인 상품 조회**: 누구나 상품 목록 열람 가능.

### **명확해진 규칙**
1. **사업자등록번호**: 회원가입 시 필수 입력.
2. **상품 수정 제약**: 
   - 판매자: 가격만 수정 가능, 재고/이미지 수정 불가.
   - 운영자: 모든 항목 수정 가능.
3. **주소 노출**: 상품 목록에서는 시/구 단위만 표시.